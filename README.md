<p align="center">
    <a href="https://github.com/MadL0rd/Endpact">
        <img src="https://img.shields.io/badge/Endpact-black?style=for-the-badge&colorA=00FF44&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjg3IiBoZWlnaHQ9IjIyNiIgdmlld0JveD0iMCAwIDI4NyAyMjYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTEwIDIyNkM5NS4wODg0IDIyNiA4My4wMDAxIDIxMy45MTIgODMuMDAwMSAxOTlDODMuMDAwMSAxOTQuMDQgODQuMzM3NCAxODkuMzkzIDg2LjY3MSAxODUuMzk5TDM2LjQ4NDIgMTM1LjIxMkMzMy4wNDU0IDEzNi45OTMgMjkuMTQwMiAxMzggMjUgMTM4QzExLjE5MjkgMTM4IDAgMTI2LjgwNyAwIDExM0MwIDk5LjE5MjggMTEuMTkyOSA4Ny45OTk5IDI1IDg3Ljk5OTlDMjkuMDc4IDg3Ljk5OTkgMzIuOTI3OSA4OC45NzYzIDM2LjMyODggOTAuNzA4MUw4OC43OTIgMzguMjQ0OUM4Ny4wMDk4IDM0Ljg5MDYgODYuMDAwMSAzMS4wNjMyIDg2LjAwMDEgMjdDODYuMDAwMSAxMy43NDUyIDk2Ljc0NTIgMyAxMTAgM0MxMjAuMDcyIDMgMTI4LjY5NSA5LjIwNDQ3IDEzMi4yNTUgMTcuOTk5OUgyMzQuNTM2QzIzOC4yNDMgNy41MTMyMyAyNDguMjQ0IDAgMjYwIDBDMjc0LjkxMiAwIDI4NyAxMi4wODgzIDI4NyAyN0MyODcgNDEuOTExNyAyNzQuOTEyIDU0IDI2MCA1NEMyNDguMjQ0IDU0IDIzOC4yNDMgNDYuNDg2NyAyMzQuNTM2IDM1Ljk5OTlIMTMyLjI1NkMxMjkuODIgNDIuMDE2MiAxMjUuMDE2IDQ2LjgyMDIgMTE5IDQ5LjI1NTVWMTA0SDE4My4wMzRDMTg2Ljg0OSA5Ni41Nzg2IDE5NC41ODIgOTEuNTAxOSAyMDMuNTAxIDkxLjUwMTlDMjE2LjIwNCA5MS41MDE5IDIyNi41MDEgMTAxLjc5OSAyMjYuNTAxIDExNC41MDJDMjI2LjUwMSAxMjcuMjA0IDIxNi4yMDQgMTM3LjUwMiAyMDMuNTAxIDEzNy41MDJDMTkzLjQyNCAxMzcuNTAyIDE4NC44NjEgMTMxLjAyMSAxODEuNzUxIDEyMkgxMTlWMTczLjUzNkMxMjYuNjcyIDE3Ni4yNDggMTMyLjc1MiAxODIuMzI4IDEzNS40NjQgMTkwSDIxOC40ODNDMjIxLjk2MiAxODAuMzc4IDIzMS4xNzggMTczLjUwMiAyNDIgMTczLjUwMkMyNTUuODA3IDE3My41MDIgMjY3IDE4NC42OTUgMjY3IDE5OC41MDJDMjY3IDIxMi4zMDkgMjU1LjgwNyAyMjMuNTAyIDI0MiAyMjMuNTAyQzIzMS41NTUgMjIzLjUwMiAyMjIuNjA2IDIxNy4wOTcgMjE4Ljg2NyAyMDhIMTM1LjQ2NEMxMzEuNzU3IDIxOC40ODcgMTIxLjc1NiAyMjYgMTEwIDIyNlpNNDguNzI4MSAxMjJMMTAwLjQ2MSAxNzMuNzMzQzEwMC41MzkgMTczLjcwNCAxMDAuNjE3IDE3My42NzUgMTAwLjY5NiAxNzMuNjQ2QzEwMC43OTcgMTczLjYwOSAxMDAuODk4IDE3My41NzIgMTAxIDE3My41MzZWMTIySDQ4LjcyODFaTTQ4LjQ5MjggMTA0SDEwMVY1MS40OTI4TDQ4LjQ5MjggMTA0WiIgZmlsbD0iYmxhY2siLz4KPC9zdmc+Cg=="/>
    </a>
    <a href="https://zod.dev">
        <img src="https://img.shields.io/badge/built_with-Zod-408AFF?logo=zod&colorA=FAFAFA&colorB=408AFF&style=for-the-badge"/>
    </a>
    <a href="https://www.npmjs.com/package/endpact">
        <img src="https://img.shields.io/npm/v/endpact?style=for-the-badge" alt="npm version"/>
    </a>
    <a href="./LICENSE">
        <img src="https://img.shields.io/badge/license-Apache%202.0-blue.svg?style=for-the-badge" alt="license"/>
    </a>
</p>

<p align="center">
  <img src="./assets/logo.svg" alt="Endpact logo" width="400"/>
</p>
<p align="center">
  A TypeScript library for strict API contract definitions, built on top of <a href="https://github.com/colinhacks/zod">Zod</a> and Fetch API.
</p>

## Features

- 🔒 Strict API contracts with Zod validation
- 🌐 Works with Fetch API (Node.js ≥18 and browsers)
- 🎯 Advanced TypeScript generics for great DX
- 🧩 Richly typed call results:
    - ✅ Success (default `ok` response schema)
    - ✅ Success (alternative status codes with their own schemas)
    - ⚠️ Expected errors (4xx / 5xx with schema)
    - ❌ Failure modes (timeouts, invalid data, unexpected status codes)
- 🕵️ Built-in sensitive data masking in logs
- 🛠 Customizable logging and retry strategies (coming soon)
- 📦 Tiny and tree-shakable

## Installation

```bash
npm install endpact zod
# or
yarn add endpact zod
# or
pnpm add endpact zod
```

## Quick Start

```
import { endpact } from "endpact"
import { z } from "zod"

/**
 * 1) Define endpoint schema
 */

const itemSchema = z.object({
    id: z.string(),
    name: z.string(),
}),
export const GetItemsEndpoint = endpact.makeEndpoint.withBuildFunc({
  buildFunc: (data: { searchText: string }) => ({
    method: "GET" as const,
    path: "/api/items/",
    queryParams: {
      limit: "10",
      offset: "0",
      search: data.searchText,
    },
    responses: {
      ok: itemSchema.array(),
      404: z.any().transform(() => [] as z.infer<typeof itemSchema>[]),
    },
  }),
  metadata: { authType: "queryParams" } as const,
})

/**
 * 2) Initialize service
 */
const api = new endpact.HttpApiService({
  baseUrl: "https://api.example.com",
  endpoints: {
    getItems: GetItemsEndpoint,
  },
  transform: (endpoint) => {
    endpoint.addBuildMiddlewareContentType("application/json")

    switch (endpoint.metadata.authType) {
      case "body":
        endpoint.addBuildMiddlewareCommonData({
          body: { token: "some-random-string" },
        })
        endpoint.addSensitiveData({
          request: { bodyKeyPaths: ["token"] },
        })
        break
      case "queryParams":
        endpoint.addBuildMiddlewareCommonData({
          queryParams: { token: "some-random-string" },
        })
        endpoint.addSensitiveData({
          request: { queryParams: ["token"] },
        })
        break
    }

    return endpoint
  },
  defaultRequestTimeoutMs: 20_000,
  logging: {
    name: "itemsApiService",
    logger: console,
  },
})

/**
 * 3) Call endpoint
 * Now it's auto-exposed as api.call.getItems({ searchText: 'some search string' })
 */
const result = await api.call.getItems({ searchText: "some search string" })

/**
 * 4) Handle typed result
 */
if (result.success) {
  console.log(result.data) // typed as { id: string; name: string }[]
} else if (result.errorType === "EXPECTED_ERROR") {
  console.error(result)

  // Example type hint in this branch:
  // const result: {
  //   success: false
  //   statusCode: 404
  //   statusText: string
  //   errorType: "EXPECTED_ERROR"
  //   data: never[]
  // }
}
```

## Roadmap

- [ ] Multipart/form-data support
- [ ] Advanced retry strategies (exponential backoff)
- [ ] Response `Content-Type` validation
- [ ] Advanced logging features (custom inspect for response objects)
    - [ ] Log level customization
    - [ ] Custom inspect result for response objects
- [ ] Documentation site (Astro + GitHub Pages)
- [ ] Examples & guides

## Contributing

Contributions, issues, and feature requests are welcome!  
Feel free to open an [issue](https://github.com/MadL0rd/Endpact/issues) or submit a PR.

## License

[Apache 2.0](./LICENSE) © 2025 MadL0rd
